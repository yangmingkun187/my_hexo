title: 前端优化
date: 2016-5-19 11:36:42
tags: "前端优化"
categories: "前端性能优化"
---
记录一些前端性能优化的解决方案,其中有些是现在项目中已经用到,并且能够解决问题的方案,还有一些事并没有用到,但在以后的重构中会陆续用到的方案;
[前端优化不完全指南](http://aotu.io/notes/2016/03/16/optimization/)
<!-- more -->
### 高清图适配优化
#### 纯色图『2X』
一般是类似icon的图片,在网站中会用到的地方也非常的多,当此类小icon数量比较少的话,sprite图是一种解决方案.
但如果会用到许多此类图片时,全部合并成 sprite 图，图片的 K 数也会很大，而且后期如果有修改的话还得重新合并 sprite 图,
所以这种情况推荐使用iconfont图标.我一般用[阿里巴巴矢量图标库](http://iconfont.cn/)
#### 非纯色图
非纯色图通常用『2X』图适配，适配方案可以有很多选择：媒体查询、srcset属性、image-set属性、脚本控制。
``` javascript
<img src="images/demo@1x.png" srcset="images/demo@1x.png 1x, images/demo@2x.png 2x" alt="">
```
``` css
.chain_item_icon{
    background-image: -webkit-image-set(url("images/demo@1x.png") 1x, url("images/demo@2x.png") 2x);
    background-image: image-set(url("images/demo@1x.png") 1x, url("images/demo@2x.png") 2x);
}
```

#### 设计类字体
设计类字体的实现只能用图片或通过样式 @font-face 属性去实现
* 图片方案：虽然可以高精度还原，兼容性强，但是每改动一处地方都需要换图，不方便维护，内容扩展性差，而且如果要适配高清设备，又得多一套图。
* @font-face 属性方案：字体具有矢量性，高清设备可以轻松适配，内容扩展性强，但是不同的浏览器存在渲染的差异，兼容性略弱，@font-face 字体文件大小一般又是 M 级别，会不同程度影响页面加载体验。

推荐[Fontmin](http://ecomfe.github.io/fontmin/tw#feature)

### 图片资源优化
一般图片资源会遇到"请求数多、资源浪费、加载体验"等问题.

#### 减少额外请求数
减少图片额外请求数，收益比较明显的一般有三个方法：图片合并、iconfont 图标、Base64，三个方法都有各自的优缺点：
* 图片合并
优点：兼容性强可缓存可提前加载多态图可提升图片加载显示体验
缺点：维护性差、合并图片类型以及大小控制限制高、有可能造成资源浪费
适合：修改更新少的常驻型低色位的装饰小图
* Iconfont
优点：可缓存矢量性可控性强
缺点：存在浏览器渲染差异性、只能纯色、文件体积略大
适合：纯色图标
* Base64
优点：无额外请求
缺点：不可缓存、兼容性差、代码冗余、可读性差、维护不便、CPU内存耗损大
适合：体积小复用率低的背景装饰图标

#### 资源按需加载
这个对于首屏可见图片以外的图片资源进行图片懒加载就可以了.自己写的一个例子[lazyload](https://github.com/yangmingkun187/lazyLoad)

#### 占位提示图提高加载体验
图片加载的时间长短由很多因素决定，如服务器响应时间、用户所用网络带宽、图片大小等，但无论是哪一种情况，总有一个等待的过程，在这过程总会有一个空白时间，
特别是占屏面积比较大的首屏轮播大图和采取懒加载的图片，即使图片空白时间很短，用户也会有不同程度的感知，会给用户带来一种唐突或漫长等待的感觉，
如果加载过程给图片加上体积比较小的占位提示图，则会让用户有一个图片加载预知，当图片加载完成后再呈现给用户看，这样用户在图片加载过程中看到的都是完整的图片
还有当图片加载失败的时候，展示占位图，避免系统默认的图片加载失败图标出现

### 压缩源码或者图片
js文件源代码可以采用混淆压缩的方式，
css文件的源代码可以进行普通的压缩，
JPG图片可以根据具体的质量来压缩为50%-70%，
PNG图片可以使用一些压缩软件来压缩，比如24色变成8色，去掉一些PNG格式信息等。

### 选择合适的图片格式
如果图片的颜色数较多就用JPG格式，
如果图片的颜色数较少就用PNG格式，
如果能通过服务器端判断浏览器支持webP，那就用webP和SVG格式

### 开启服务器端的Gzip压缩
这对文本资源非常有效，对图片资源没多大的压缩比率

### 使用CDN
或则一些公开库使用第三方提供的静态资源地址（jquery angular）。这样一方面增加并发下载量，另一方面能够和其他网站共享缓存
### 延长静态资源缓存时间
这里要注意，要通过修改文件名的方式，确保在资源更新的时候，用户可以拉到最新的内容（时间戳 版本号）

### 小细节
把css放在头部  把js放在页面底部
