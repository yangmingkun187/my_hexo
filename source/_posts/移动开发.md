title: 移动开发
date: 2016-03-08 18:15:19
tags: "移动端web开发"
categories: "移动端web开发"
---
记录自己在移动端web开发中遇到的问题。
<!-- more -->

### 使用rem解决不同屏幕大小的字号显示

``` javascript
(function (doc, win) {
  var docEl = doc.documentElement,
    resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
    recalc = function () {
      var clientWidth = docEl.clientWidth;
      if (!clientWidth) return;
      docEl.style.fontSize = 20 * (clientWidth / 320) + 'px';
    };

  if (!doc.addEventListener) return;
  win.addEventListener(resizeEvt, recalc, false);
  doc.addEventListener('DOMContentLoaded', recalc, false);
})(document, window);
```

### zepto tap事件穿透

移动端点击事件一般不会用click（300ms的延时触发），但是在使用tap事件的时候有一些问题，比如弹出层中点击按钮，而按钮的正下方刚好绑定了一个可点击的区域，此刻这个可点击区域的事件会被触发。
##### 解决办法：
1. 延时300ms以上的事件来处理事件，配合一些fadeout等动画，做出动画效果。
``` javascript
$(".close-btn").on("tap", function (event) {
   setTimeout(function(){
     alert('点我了');
   },301);
});  
```
2. 使用touchend。
``` javascript
$(".close-btn").on("touchend", function (event) {
   event.preventDefault();
   alert('点我了');
});  
```

### iscroll5 的上拉加载，下拉刷新

iscroll4之前有这个功能，但是在iscroll5里面被移除了，
github上，我写了一个针对iscroll5实现上拉加载，下拉刷新功能的demo [isrcoll5-fresh-demo](https://github.com/yangmingkun187/isrcoll5-fresh-demo.git)

### 同屏切换的问题

使用transform实现同屏切换后，在当前屏点击后退键，我们期望的是回到前一屏，但是实际上会回到前一个页面。因为同屏切换url并没有变，只是页面上的可视区域变了。
解决办法：
在切屏操作的时候，执行下面：
``` javascript
if(history.pushState){
    history.pushState('status','',location.href.split('?')[0]+'?status');
}
```
然后监听popstate：
``` javascript
if(history.pushState){
    window.addEventListener('popstate',function(){
        // 点击后退键执行的操作
    })
}
```

![Alt text](http://gtms01.alicdn.com/tps/i1/T1N9rZFdddXXbZIE3X-1200-900.png)
